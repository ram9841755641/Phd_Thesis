/* * jQuery Address Plugin v1.2.1 * http://www.asual.com/jquery/address/ * * Copyright (c) 2009-2010 Rostislav Hristov * Dual licensed under the MIT or GPL Version 2 licenses. * http://jquery.org/license * * Date: 2010-06-10 10:21:35 +0300 (Thu, 10 Jun 2010) */(function(c) {
    c.address = function() {
        var t = function(a) { c(c.address).trigger(c.extend(c.Event(a), function() { for (var b = {}, e = c.address.parameterNames(), h = 0, q = e.length; h < q; h++) b[e[h]] = c.address.parameter(e[h]); return { value: c.address.value(), path: c.address.path(), pathNames: c.address.pathNames(), parameterNames: e, parameters: b, queryString: c.address.queryString()} } .call(c.address))) }, u = function(a, b, e) { c(c.address).bind(a, b, e); return c.address }, p = function() { var a = d.href.indexOf("#"); return a != -1 ? W(H(r(d.href.substr(a + 1), j))) : "" }, X = function() { return "javascript" }, Y = function(a, b) { if (i.strict) a = b ? a.substr(0, 1) != "/" ? "/" + a : a : a == "" ? "/" : a; return a }, I = function(a, b) { return s && d.protocol == "file:" ? b ? g.replace(/\?/, "%3F") : g.replace(/%253F/, "?") : a }, r = function(a, b) { if (i.crawlable && b) return (a != "" ? "!" : "") + a; return a.replace(/^\!/, "") }, v = function(a, b) { return parseInt(a.css(b), 10) }, Z = function(a) { for (var b, e, h = 0, q = a.childNodes.length; h < q; h++) { if (a.childNodes[h].src) b = String(a.childNodes[h].src); if (e = Z(a.childNodes[h])) b = e } return b }, F = function() { if (!J) { var a = p(), b = g != a; if (w && m < 523) { if (A != D.length) { A = D.length; if (typeof x[A - 1] != y) g = x[A - 1]; E(j) } } else if (s && m < 7 && b) d.reload(); else if (b) { g = a; E(j) } } }, E = function(a) { t($); t(a ? aa : ba); B(ca, 10) }, ca =
function() {
    var a = (d.pathname + (/\/$/.test(d.pathname) ? "" : "/") + (c.address ? c.address.value() : "")).replace(/\/\/$/, "/").replace(/^\/$/, ""),
  b = n[i.tracker];
    if (typeof b == K)
    { }
    else if (typeof urchinTracker == K)
    { }
    else if (typeof pageTracker != y && typeof pageTracker._trackPageview == K)
    { }
    else { }
}, da = function() { var a = l.contentWindow.document; a.open(); a.write("<html><head><title>" + k.title + "</title><script>var " + o + ' = "' + p() + '";<\/script></head></html>'); a.close() }, ga = function() { if (!ea) { ea = f; if (L && fa != -1) { var a, b = L.substr(fa + 1).split("&"); for (C = 0; C < b.length; C++) { a = b[C].split("="); if (/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0])) i[a[0]] = isNaN(a[1]) ? /^(true|yes)$/i.test(a[1]) : parseInt(a[1], 10) !== 0; if (/^tracker$/.test(a[0])) i[a[0]] = a[1] } } a = c("body").ajaxComplete(function() { ka.call(this) }).trigger("ajaxComplete"); if (i.wrap) { c("body > *").wrapAll('<div style="padding:' + (v(a, "marginTop") + v(a, "paddingTop")) + "px " + (v(a, "marginRight") + v(a, "paddingRight")) + "px " + (v(a, "marginBottom") + v(a, "paddingBottom")) + "px " + (v(a, "marginLeft") + v(a, "paddingLeft")) + 'px;" />').parent().wrap('<div id="' + o + '" style="height:100%; overflow:auto;' + (w ? window.statusbar.visible && !/chrome/i.test(O) ? "" : " resize:both;" : "") + '" />'); c("html, body").css({ height: "100%", margin: 0, padding: 0, overflow: "hidden" }); w && c('<style type="text/css" />').appendTo("head").text("#" + o + "::-webkit-resizer { background-color: #fff; }") } if (s && m < 8) { a = k.getElementsByTagName("frameset")[0]; l = k.createElement((a ? "" : "i") + "frame"); if (a) { a.insertAdjacentElement("beforeEnd", l); a[a.cols ? "cols" : "rows"] += ",0"; l.src = X() + ":" + j; l.noResize = f; l.frameBorder = l.frameSpacing = 0 } else { l.src = X() + ":" + j; l.style.display = "none"; k.body.insertAdjacentElement("afterBegin", l) } B(function() { c(l).bind("load", function() { var e = l.contentWindow; g = typeof e[o] != y ? e[o] : ""; if (g != p()) { E(j); d.hash = I(r(g, f), f) } }); typeof l.contentWindow[o] == y && da() }, 50) } else if (w) { if (m < 418) { c(k.body).append('<form id="' + o + '" style="position:absolute;top:-9999px;" method="get"></form>'); P = k.getElementById(o) } if (typeof d[o] == y) d[o] = {}; if (typeof d[o][d.pathname] != y) x = d[o][d.pathname].split(",") } B(function() { t("init"); E(j) }, 1); if (s && m > 7 || !s && "on" + G in n) if (n.addEventListener) n.addEventListener(G, F, false); else n.attachEvent && n.attachEvent("on" + G, F); else la(F, 50); c("a").filter("[rel*=address:]").address() } }, ma = function() { if (n.removeEventListener) n.removeEventListener(G, F, false); else n.detachEvent && n.detachEvent("on" + G, F) }, ka = function() { var a = d.pathname.replace(/\/$/, ""); c("body").html().indexOf("_escaped_fragment_") != -1 && c("a[href]:not([href^=http])", this).each(function() { var b = c(this).attr("href").replace(new RegExp(a + "/?$"), ""); if (b == "" || b.indexOf("_escaped_fragment_") != -1) c(this).attr("href", "#" + decodeURIComponent(b.replace(/\/(.*)\?_escaped_fragment_=(.*)$/, "!$2"))) }) }, o = "jQueryAddress", K = "function", y = "undefined", G = "hashchange", $ = "change", aa = "internalChange", ba = "externalChange", f = true, j = false, i = { autoUpdate: f, crawlable: j, history: f, strict: f, wrap: j }, M = c.browser, m = parseFloat(c.browser.version), ha = M.mozilla, s = M.msie, ia = M.opera, w = M.safari, Q = j, n = function() { try { return top.document !== undefined ? top : window } catch (a) { return window } } (), k = n.document, D = n.history, d = n.location, la = setInterval, B = setTimeout, H = decodeURI, W = encodeURI, O = navigator.userAgent, l, P, L = Z(document), fa = L ? L.indexOf("?") : -1, R = k.title, A = D.length, J = j, ea = j, S = f, ja = f, N = j, x = [], g = p(); if (s) { m = parseFloat(O.substr(O.indexOf("MSIE") + 4)); if (k.documentMode && k.documentMode != m) m = k.documentMode != 8 ? 7 : 8; c(document).bind("propertychange", function() { if (k.title != R && k.title.indexOf("#" + p()) != -1) k.title = R }) } if (Q = ha && m >= 1 || s && m >= 6 || ia && m >= 9.5 || w && m >= 312) { for (var C = 1; C < A; C++) x.push(""); x.push(g); if (s && d.hash != g) d.hash = "#" + I(r(g, f), f); if (ia) history.navigationMode = "compatible"; if (document.readyState == "complete") var na = setInterval(function() { if (c.address) { ga(); clearInterval(na) } }, 50); else c(ga); c(window).bind("unload", ma) } else if (!Q && p() != "" || w && m < 418 && p() != "" && d.search != "") { k.open(); k.write('<html><head><meta http-equiv="refresh" content="0;url=' + encodeURI(d.href.substr(0, d.href.indexOf("#"))) + '" /></head></html>'); k.close() } else ca(); return { bind: function(a, b, e) { return u(a, b, e) }, init: function(a) { return u("init", a) }, change: function(a) { return u($, a) }, internalChange: function(a) { return u(aa, a) }, externalChange: function(a) { return u(ba, a) }, baseURL: function() { var a = d.href; if (a.indexOf("#") != -1) a = a.substr(0, a.indexOf("#")); if (/\/$/.test(a)) a = a.substr(0, a.length - 1); return a }, autoUpdate: function(a) { if (a !== undefined) { i.autoUpdate = a; return this } return i.autoUpdate }, crawlable: function(a) { if (a !== undefined) { i.crawlable = a; return this } return i.crawlable }, history: function(a) { if (a !== undefined) { i.history = a; return this } return i.history }, strict: function(a) { if (a !== undefined) { i.strict = a; return this } return i.strict }, tracker: function(a) { if (a !== undefined) { i.tracker = a; return this } return i.tracker }, wrap: function(a) { if (a !== undefined) { i.wrap = a; return this } return i.wrap }, update: function() { N = f; this.value(g); N = j; return this }, title: function(a) { if (a !== undefined) { a = H(a); B(function() { R = k.title = a; if (ja && l && l.contentWindow && l.contentWindow.document) { l.contentWindow.document.title = a; ja = j } if (!S && ha) d.replace(d.href.indexOf("#") != -1 ? d.href : d.href + "#"); S = j }, 50); return this } return k.title }, value: function(a) { if (a !== undefined) { a = W(H(Y(a, f))); if (a == "/") a = ""; if (g == a && !N) return; S = f; g = a; if (i.autoUpdate || N) { J = f; E(f); x[D.length] = g; if (w) if (i.history) { d[o][d.pathname] = x.toString(); A = D.length + 1; if (m < 418) { if (d.search == "") { P.action = "#" + r(g, f); P.submit() } } else if (m < 523 || g == "") { a = k.createEvent("MouseEvents"); a.initEvent("click", f, f); var b = k.createElement("a"); b.href = "#" + r(g, f); b.dispatchEvent(a) } else d.hash = "#" + r(g, f) } else d.replace("#" + r(g, f)); else if (g != p()) if (i.history) d.hash = "#" + I(r(g, f), f); else d.replace("#" + r(g, f)); s && m < 8 && i.history && B(da, 50); if (w) B(function() { J = j }, 1); else J = j } return this } if (!Q) return null; return H(Y(I(g, j), j)) }, path: function(a) { if (a !== undefined) { var b = this.queryString(), e = this.hash(); this.value(a + (b ? "?" + b : "") + (e ? "#" + e : "")); return this } return this.value().split("#")[0].split("?")[0] }, queryString: function(a) { if (a !== undefined) { var b = this.hash(); this.value(this.path() + (a ? "?" + a : "") + (b ? "#" + b : "")); return this } a = this.value().split("?"); return a.slice(1, a.length).join("?").split("#")[0] }, parameter: function(a, b, e) { var h, q; if (b !== undefined) { var T = this.parameterNames(); q = []; for (h = 0; h < T.length; h++) { var U = T[h], z = this.parameter(U); if (typeof z == "string") z = [z]; if (U == a) z = b === null || b === "" ? [] : e ? z.concat([b]) : [b]; for (var V = 0; V < z.length; V++) q.push(U + "=" + z[V]) } c.inArray(a, T) == -1 && b !== null && b !== "" && q.push(a + "=" + b); this.queryString(q.join("&")); return this } if (b = this.queryString()) { q = b.split("&"); b = []; for (h = 0; h < q.length; h++) { e = q[h].split("="); e[0] == a && b.push(e[1]) } if (b.length !== 0) return b.length != 1 ? b : b[0] } }, pathNames: function() { var a = this.path(), b = a.replace(/\/{2,9}/g, "/").split("/"); if (a.substr(0, 1) == "/" || a.length === 0) b.splice(0, 1); a.substr(a.length - 1, 1) == "/" && b.splice(b.length - 1, 1); return b }, parameterNames: function() { var a = this.queryString(), b = []; if (a && a.indexOf("=") != -1) { a = a.split("&"); for (var e = 0; e < a.length; e++) { var h = a[e].split("=")[0]; c.inArray(h, b) == -1 && b.push(h) } } return b }, hash: function(a) { if (a !== undefined) { this.value(this.value().split("#")[0] + (a ? "#" + a : "")); return this } a = this.value().split("#"); return a.slice(1, a.length).join("#") } }
    } (); c.fn.address = function(t) { var u = function() { if (c(this).is("a")) { var p = t ? t.call(this) : /address:/.test(c(this).attr("rel")) ? c(this).attr("rel").split("address:")[1].split(" ")[0] : c(this).attr("href").replace(/^#\!?/, ""); c.address.value(p); return false } }; c(this).click(u).live("click", u); c(this).submit(function() { if (c(this).is("form")) { var p = t ? t.call(this) : c(this).attr("action") + "?" + c(this).serialize(); c.address.value(p); return false } }); return this } 
})(jQuery);