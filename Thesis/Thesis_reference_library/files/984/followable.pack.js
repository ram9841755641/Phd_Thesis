YUI.add("bepress.follow",function(g){var i=g.namespace("bepress.follow"),f="message_overlay",k='{message}            	<p class="close-window"><button type="button" class="follow_cancel close">x</button></p>            	<p>Please log in with your bepress Digital Commons or SelectedWorks account.</p>            	<p> <a             			class="btn btn-mini pull-right"            			href="{signup_url}"><strong>Create a free account <i class="icon-arrow-right"></i></strong></a>            	</p>            	<hr />            	<form class="login-form">            		<p class="row-fluid">            			<label for="email" class="span4">Email:</label>            			<input class="follow_login span8" type="text" id="email" placeholder="you@email.com">            		</p>                	<p class="row-fluid">                		<label for="password" class="span4">Password:</label>                		<input type="password" class="follow_password span8" id="password">                	</p>                	<p class="row-fluid">                		<label for="save_password" class="span4">Remember Me:</label>                		<input type="checkbox" class="save_password" id="save_password" value="1">                	</p>                	<p class="row-fluid">                		<span class="forgot span8"><input                			type="submit"                			class="follow do_login btn btn-primary btn-mini"                			value="Sign in"><a                					href="{reset_url}" target="_new"><small>Forgot Password?</small></a></span>                	</p>                </form>',A="<p><strong>Log in to {target}</strong></p>",u=/(http(?:s)?):\/\/(.+?)\//,x='<b class="{message_class}">{message}</b><p style="{style}">{details}</p>',r="bp",q="net",d=".followable",n,a=g.bepress.webservice.SWSRequest,h=g.bepress.webservice.ConfigLoader,o=g.bepress.webservice.getMessagePanel;new h(function(E){n=E;p();}).run();function b(I){var H=I.getAttribute("data-follow-set").split(/[ ;]/),F={},E,G;for(G=0;G<H.length;G++){E=H[G].split(":");F[E[0]]=E[1];}return F;}function j(I,F,M,G){var E=I.target,K=E.one(".follow_login").get("value"),L=E.one(".follow_password").get("value"),H=E.one(".save_password").get("checked"),J="email="+encodeURIComponent(K)+"&password="+encodeURIComponent(L);if(H){J+="&save_password=1";}swsRequestConfig={method:"POST",data:J,"arguments":{eventNode:F,followSet:M,eventDate:G,loginName:K},on:{success:function(O,P){var R=g.getLocation(),Q=R.host;if(O.status=="OK"){var N={path:"/"};if(O.cookie_expires){N.expires=new Date(O.cookie_expires);}if(/\bbepress\.com$/.exec(Q)){if(!g.bepress.webservice.getAuthCookie()){N.domain="bepress.com";g.bepress.webservice.setAuthCookie(O.cookie_name,O.cookieval,N);}}else{g.bepress.webservice.setAuthCookie(O.cookie_name,O.cookieval,N);}w(P.eventNode);panel=o(P.eventNode);panel.hide();}else{e("E_REJECTED",P.eventNode,P.followSet,P.eventDate,P.loginName);}},failure:function(N){panel=o(N.eventNode);panel.setMessage({message:c("E_GENERAL"),classnames:"error",details:""});panel.show(5000);}}};I.halt();new a(n[r].sw_wsurl+"/login/login",swsRequestConfig);}var l={E_REJECTED:'<i class="icon-exclamation-sign"></i> The email address and/or password you entered is invalid.',E_GENERAL:"Oops!  An error occurred processing your<br>request.  Our team is investigating and will<br>fix the problem as soon as possible."};var t='<div class="{message_class}">{message}</div>';function c(G,F){var E=G?G:"";if(l[G]){E=g.substitute(t,{message_class:F?F:G.match(/^E_/)?"error":"note",message:l[G]});}return E;}function s(F){var E=g.stamp(F);g.all(".followable").each(function(H){if(g.stamp(H)!==E){var G=o(H);if(G){G.hide();}}});}function e(F,G,M,H,J){var I,K=c(F),E=b(G),L;s(G);panel=o(G);L=n[r].sw_wsurl+"/signup/?return_to="+escape(window.location)+"&follow_subscribe="+escape(g.QueryString.stringify(E))+"&login_site="+window.location.host;panel.set("bodyContent",g.substitute(k,{signup_url:L,reset_url:n[r].sw_wsurl+"/reset",message:K}));panel.set("headerContent",g.substitute(A,{target:G.get("title")}));panel.show();I=panel.getOverlay().getStdModNode(g.WidgetStdMod.BODY);I.one("form.login-form").on("submit",j,null,G,M,H);I.one(".follow_cancel").on("click",function(){panel.hide();});if(J){I.one(".follow_login").set("value",J);I.one(".follow_password").focus();}else{I.one(".follow_login").focus();}}function y(E,F){if(E.reason==="NOT_AUTHORIZED"){e("",F.eventNode,F.followSet,F.eventDate);}else{panel=o(F.eventNode);panel.setMessage({message:c("E_GENERAL"),classnames:"error",details:g.dump(E),showDetails:E.is_dev?true:false});panel.show(5000);}}function v(F){var E=F.getData("initialClasses");if(E&&E.indexOf("followable-unsubscribe")>-1){F.set("innerHTML",F.getData("initialContent"));F.setAttribute("class",F.getData("initialClasses"));F.setAttribute("title",F.getData("initialTitle"));}else{F.set("innerHTML",'<i class="icon-ok"></i> Following');F.removeClass("btn-primary");F.addClass("following");}}function C(E){E.set("innerHTML",'<i class="icon-exclamation-sign icon-white"></i> Removed');E.removeClass("btn-danger");E.removeClass("followable-unsubscribe");E.addClass("btn-warning");E.set("title","Click to follow again.");}function w(I){var F=b(I),E=g.bepress.webservice.getAuthCookie(),G,H=new Date();if(I.getData(f)){I.getData(f).hide();if(I.getData("hideTimer")){clearTimeout(I.getData("hideTimer"));I.setData("hideTimer",null);}}if(E){F.auth_cookie=E;}G=n[q].wsurl+"/follow/subscribe?"+g.QueryString.stringify(F);new a(G,{"arguments":{eventNode:I,followSet:F,eventDate:H},on:{success:function(J,K){if(J.status==="OK"){v(K.eventNode);}else{y(J,K);}},failure:function(J){y({status:"ERROR_HTTP"},J);}}});}function B(I){var F=b(I),E=g.bepress.webservice.getAuthCookie(),G,H=new Date();if(I.getData(f)){I.getData(f).hide();if(I.getData("hideTimer")){clearTimeout(I.getData("hideTimer"));I.setData("hideTimer",null);}}if(E){F.auth_cookie=E;}G=n[q].wsurl+"/follow/unsubscribe?"+g.QueryString.stringify(F);new a(G,{"arguments":{eventNode:I,followSet:F,eventDate:H},on:{success:function(J,K){if(J.status==="OK"){C(K.eventNode);}else{y(J,K);}},failure:function(J){y({status:"ERROR_HTTP"},J);}}});}function D(L,J){var F=L.get("winHeight"),I=L.get("winWidth"),H,N,E=m(L),G=m(J),M,K;if(document.documentElement&&typeof(document.documentElement.scrollTop)=="number"){H=document.documentElement.scrollTop;N=document.documentElement.scrollLeft;}else{H=document.body.scrollTop;N=document.body.scrollLeft;}if((E.left+E.width)+(G.width)<I-N){M=E.left+E.width;}else{if(E.left+(E.width/2)+G.width<I-N){M=E.left+(E.width/2);}else{M=(E.left+(E.width/2))-G.width;}}if(E.top+E.height+G.height<F+H){K=E.top+E.height;}else{K=E.top-G.height;}return[M,K];}function m(F){var E={left:F.getX(),top:F.getY(),width:parseInt(F.get("offsetWidth")),height:parseInt(F.get("offsetHeight"))};return E;}function z(F){var G=F.target;while(G.get("nodeName")!=="A"){G=G.ancestor("a");}if(G.hasClass("followable-unsubscribe")){F.halt();B(G);}else{if(G.hasClass("following")){var E=g.substitute("{proto}//{host}/do/dcn/mgr/follows",{proto:n.protocol,host:n[r].host});G.setAttribute("href",E);G.setAttribute("target","_blank");}else{F.halt();w(G);}}}function p(){var E=g.bepress.webservice.getAuthCookie(),F=g.all(d),G=n[q].wsurl+"/follow/list";if(E&&F.size()){new a(G,{data:"auth_cookie="+encodeURIComponent(E),on:{success:function(L,J){if(L.status==="OK"){var K=0,I,H;for(K=0;K<L.content.subscriptions.length;K++){I=L.content.subscriptions[K].split(";");H=I.join(" ");F.each(function(M){if(M.getAttribute("data-follow-set")===H){v(M);}});}}F.each(function(M){M.setStyle("opacity",1);});},failure:function(H){g.all(d).each(function(I){I.setStyle("opacity",1);});}}});}else{F.each(function(H){H.setStyle("opacity",1);});}}g.on("domready",function(){var E=g.all(d);g.one("assigning followable items");E.on("click",z);E.each(function(F){F.setData("initialClasses",F.getAttribute("class"));F.setData("initialTitle",F.getAttribute("title"));F.setData("initialContent",F.get("innerHTML"));if(F.hasClass("followable-unsubscribe")){F.setData("canUnsubscribe",true);}});g.one("followable items assigned");});},"0.2",{requires:["bepress.webservice","bepress.followcss","dump"]});